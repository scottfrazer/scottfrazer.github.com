<!DOCTYPE HTML>
<html>
  <head>
    <style>
      body {
        margin: 0px;
        padding: 0px;
      }
      #myCanvas {
        border: 1px solid #9C9898;
      }
    </style>
    <script>
      function writeMessage(canvas, message) {
        var context = canvas.getContext('2d');
        var x = canvas.width - 75;
        var y = canvas.height - 40;
        context.fillRect(x,y,3,3);
        context.clearRect(x, y, canvas.width, canvas.height);
        context.font = '12pt Calibri';
        context.fillStyle = 'black';
        context.fillText(message, x, canvas.height - 10);
      }

      function getMousePos(canvas, evt) {
        var rect = canvas.getBoundingClientRect(), root = document.documentElement;

        // return relative mouse position
        var mouseX = evt.clientX - rect.top - root.scrollTop;
        var mouseY = evt.clientY - rect.left - root.scrollLeft;
        return {
          x: mouseX,
          y: mouseY
        };
      }

      window.onload = function() {
        var canvas = document.getElementById("myCanvas");
        var context = canvas.getContext("2d");
        var centerX = canvas.width / 2;
        var centerY = canvas.height / 2;
        var radius = 40;

        context.lineWidth = 5;

        circle0 = {
          x: centerX + radius + 100 + radius,
          y: centerY,
          radius: radius
        }

        circle1 = {
          x: centerX,
          y: centerY,
          radius: radius
        }

        line1 = {
          start: circle0,
          end: circle1
        }

        function closest_point_on_circle(circle, x, y) {
          var vX = x - circle.x;
          var vY = y - circle.y;
          var magV = Math.sqrt(vX*vX + vY*vY);
          var aX = circle.x + vX / magV * circle.radius;
          var aY = circle.y + vY / magV * circle.radius;
          return {x: aX, y: aY};
        }

        function is_in_circle(circle, x, y) {
          return ((x - circle.x)^2 + (y - circle.y)^2 < circle.radius^2);
        }

        function redraw() {
          context.beginPath();
          context.arc(circle1.x, circle1.y, circle1.radius, 0, 2 * Math.PI, false);
          context.fillStyle = "#cc0000";
          context.fill();
          context.lineWidth = 5;
          context.strokeStyle = "black";
          context.stroke();

          context.beginPath();
          context.arc(circle0.x, circle0.y, circle0.radius, 0, 2 * Math.PI, false);
          context.fillStyle = "#00cc00";
          context.fill();
          context.lineWidth = 5;
          context.strokeStyle = "black";
          context.stroke();

          start_coords = closest_point_on_circle(line1.start, line1.end.x, line1.end.y);
          end_coords = closest_point_on_circle(line1.end, line1.start.x, line1.start.y);
          context.beginPath();
          context.moveTo(start_coords.x, start_coords.y);
          context.lineTo(end_coords.x, end_coords.y);
          context.lineJoin = "miter";
          context.stroke();
        }

        redraw();

        canvas.addEventListener('mousemove', function(evt) {
          var mousePos = getMousePos(canvas, evt);
          var message = "(" +mousePos.x + "," + mousePos.y + ")";
          writeMessage(canvas, message);
        }, false);
        
        canvas.addEventListener('click', function(evt) {
          var mousePos = getMousePos(canvas, evt);
          var message = "c(" +mousePos.x + "," + mousePos.y + ")";
          writeMessage(canvas, message);
        }, false);
      };
    </script>
  </head>
  <body>
    <canvas id="myCanvas" width="600" height="600"></canvas>
  </body>
</html>
